!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ClassTransformer={})}(this,(function(t){"use strict";var e;t.TransformationType=void 0,(e=t.TransformationType||(t.TransformationType={}))[e.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",e[e.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",e[e.CLASS_TO_CLASS=2]="CLASS_TO_CLASS";var n=new(function(){function e(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return e.prototype.addTypeMetadata=function(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)},e.prototype.addTransformMetadata=function(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)},e.prototype.addExposeMetadata=function(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)},e.prototype.addExcludeMetadata=function(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)},e.prototype.findTransformMetadatas=function(e,n,o){return this.findMetadatas(this._transformMetadatas,e,n).filter((function(e){return!e.options||(!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?o===t.TransformationType.CLASS_TO_CLASS||o===t.TransformationType.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||o===t.TransformationType.CLASS_TO_PLAIN))}))},e.prototype.findExcludeMetadata=function(t,e){return this.findMetadata(this._excludeMetadatas,t,e)},e.prototype.findExposeMetadata=function(t,e){return this.findMetadata(this._exposeMetadatas,t,e)},e.prototype.findExposeMetadataByCustomName=function(t,e){return this.getExposedMetadatas(t).find((function(t){return t.options&&t.options.name===e}))},e.prototype.findTypeMetadata=function(t,e){return this.findMetadata(this._typeMetadatas,t,e)},e.prototype.getStrategy=function(t){var e=this._excludeMetadatas.get(t),n=e&&e.get(void 0),o=this._exposeMetadatas.get(t),r=o&&o.get(void 0);return n&&r||!n&&!r?"none":n?"excludeAll":"exposeAll"},e.prototype.getExposedMetadatas=function(t){return this.getMetadata(this._exposeMetadatas,t)},e.prototype.getExcludedMetadatas=function(t){return this.getMetadata(this._excludeMetadatas,t)},e.prototype.getExposedProperties=function(e,n){return this.getExposedMetadatas(e).filter((function(e){return!e.options||(!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?n===t.TransformationType.CLASS_TO_CLASS||n===t.TransformationType.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||n===t.TransformationType.CLASS_TO_PLAIN))})).map((function(t){return t.propertyName}))},e.prototype.getExcludedProperties=function(e,n){return this.getExcludedMetadatas(e).filter((function(e){return!e.options||(!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?n===t.TransformationType.CLASS_TO_CLASS||n===t.TransformationType.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||n===t.TransformationType.CLASS_TO_PLAIN))})).map((function(t){return t.propertyName}))},e.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},e.prototype.getMetadata=function(t,e){var n,o=t.get(e);o&&(n=Array.from(o.values()).filter((function(t){return void 0!==t.propertyName})));for(var r=[],a=0,i=this.getAncestors(e);a<i.length;a++){var s=i[a],p=t.get(s);if(p){var f=Array.from(p.values()).filter((function(t){return void 0!==t.propertyName}));r.push.apply(r,f)}}return r.concat(n||[])},e.prototype.findMetadata=function(t,e,n){var o=t.get(e);if(o){var r=o.get(n);if(r)return r}for(var a=0,i=this.getAncestors(e);a<i.length;a++){var s=i[a],p=t.get(s);if(p){var f=p.get(n);if(f)return f}}},e.prototype.findMetadatas=function(t,e,n){var o,r=t.get(e);r&&(o=r.get(n));for(var a=[],i=0,s=this.getAncestors(e);i<s.length;i++){var p=s[i],f=t.get(p);f&&f.has(n)&&a.push.apply(a,f.get(n))}return a.slice().reverse().concat((o||[]).slice().reverse())},e.prototype.getAncestors=function(t){if(!t)return[];if(!this._ancestorsMap.has(t)){for(var e=[],n=Object.getPrototypeOf(t.prototype.constructor);void 0!==n.prototype;n=Object.getPrototypeOf(n.prototype.constructor))e.push(n);this._ancestorsMap.set(t,e)}return this._ancestorsMap.get(t)},e}());var o=function(t,e){for(var n=0,o=e.length,r=t.length;n<o;n++,r++)t[r]=e[n];return t};var r=function(){function e(t,e){this.transformationType=t,this.options=e,this.recursionStack=new Set}return e.prototype.transform=function(e,o,r,a,i,s){var p,f=this;if(void 0===s&&(s=0),Array.isArray(o)||o instanceof Set){var u=a&&this.transformationType===t.TransformationType.PLAIN_TO_CLASS?function(t){var e=new t;return e instanceof Set||"push"in e?e:[]}(a):[];return o.forEach((function(n,o){var a=e?e[o]:void 0;if(f.options.enableCircularCheck&&f.isCircular(n))f.transformationType===t.TransformationType.CLASS_TO_CLASS&&(u instanceof Set?u.add(n):u.push(n));else{var i=void 0;if("function"!=typeof r&&r&&r.options&&r.options.discriminator&&r.options.discriminator.property&&r.options.discriminator.subTypes){if(f.transformationType===t.TransformationType.PLAIN_TO_CLASS){i=r.options.discriminator.subTypes.find((function(t){return t.name===n[r.options.discriminator.property]}));var p={newObject:u,object:n,property:void 0},c=r.typeFunction(p);i=void 0===i?c:i.value,r.options.keepDiscriminatorProperty||delete n[r.options.discriminator.property]}f.transformationType===t.TransformationType.CLASS_TO_CLASS&&(i=n.constructor),f.transformationType===t.TransformationType.CLASS_TO_PLAIN&&(n[r.options.discriminator.property]=r.options.discriminator.subTypes.find((function(t){return t.value===n.constructor})).name)}else i=r;var d=f.transform(a,n,i,void 0,n instanceof Map,s+1);u instanceof Set?u.add(d):u.push(d)}})),u}if(r!==String||i){if(r!==Number||i){if(r!==Boolean||i){if((r===Date||o instanceof Date)&&!i)return o instanceof Date?new Date(o.valueOf()):null==o?o:new Date(o);if(("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).Buffer&&(r===Buffer||o instanceof Buffer)&&!i)return null==o?o:Buffer.from(o);if(null===(p=o)||"object"!=typeof p||"function"!=typeof p.then||i){if(i||null===o||"object"!=typeof o||"function"!=typeof o.then){if("object"==typeof o&&null!==o){r||o.constructor===Object||(r=o.constructor),!r&&e&&(r=e.constructor),this.options.enableCircularCheck&&this.recursionStack.add(o);var c=this.getKeys(r,o,i),d=e||{};e||this.transformationType!==t.TransformationType.PLAIN_TO_CLASS&&this.transformationType!==t.TransformationType.CLASS_TO_CLASS||(d=i?new Map:r?new r:{});for(var l=function(a){if("__proto__"===a||"constructor"===a)return"continue";var p=a,f=a,u=a;if(!y.options.ignoreDecorators&&r)if(y.transformationType===t.TransformationType.PLAIN_TO_CLASS)(c=n.findExposeMetadataByCustomName(r,a))&&(u=c.propertyName,f=c.propertyName);else if(y.transformationType===t.TransformationType.CLASS_TO_PLAIN||y.transformationType===t.TransformationType.CLASS_TO_CLASS){var c;(c=n.findExposeMetadata(r,a))&&c.options&&c.options.name&&(f=c.options.name)}var l=void 0;l=y.transformationType===t.TransformationType.PLAIN_TO_CLASS?o[p]:o instanceof Map?o.get(p):o[p]instanceof Function?o[p]():o[p];var T=void 0,m=l instanceof Map;if(r&&i)T=r;else if(r){var h=n.findTypeMetadata(r,u);if(h){var v={newObject:d,object:o,property:u},S=h.typeFunction?h.typeFunction(v):h.reflectedType;h.options&&h.options.discriminator&&h.options.discriminator.property&&h.options.discriminator.subTypes?o[p]instanceof Array?T=h:(y.transformationType===t.TransformationType.PLAIN_TO_CLASS&&(T=void 0===(T=h.options.discriminator.subTypes.find((function(t){if(l&&l instanceof Object&&h.options.discriminator.property in l)return t.name===l[h.options.discriminator.property]})))?S:T.value,h.options.keepDiscriminatorProperty||l&&l instanceof Object&&h.options.discriminator.property in l&&delete l[h.options.discriminator.property]),y.transformationType===t.TransformationType.CLASS_TO_CLASS&&(T=l.constructor),y.transformationType===t.TransformationType.CLASS_TO_PLAIN&&l&&(l[h.options.discriminator.property]=h.options.discriminator.subTypes.find((function(t){return t.value===l.constructor})).name)):T=S,m=m||h.reflectedType===Map}else if(y.options.targetMaps)y.options.targetMaps.filter((function(t){return t.target===r&&!!t.properties[u]})).forEach((function(t){return T=t.properties[u]}));else if(y.options.enableImplicitConversion&&y.transformationType===t.TransformationType.PLAIN_TO_CLASS){var _=Reflect.getMetadata("design:type",r.prototype,u);_&&(T=_)}}var g=Array.isArray(o[p])?y.getReflectedType(r,u):void 0,A=e?e[p]:void 0;if(d.constructor.prototype){var M=Object.getOwnPropertyDescriptor(d.constructor.prototype,f);if((y.transformationType===t.TransformationType.PLAIN_TO_CLASS||y.transformationType===t.TransformationType.CLASS_TO_CLASS)&&(M&&!M.set||d[f]instanceof Function))return"continue"}if(y.options.enableCircularCheck&&y.isCircular(l)){if(y.transformationType===t.TransformationType.CLASS_TO_CLASS){L=l;(void 0!==(L=y.applyCustomTransformations(L,r,a,o,y.transformationType))||y.options.exposeUnsetFields)&&(d instanceof Map?d.set(f,L):d[f]=L)}}else{var C=y.transformationType===t.TransformationType.PLAIN_TO_CLASS?f:a,L=void 0;y.transformationType===t.TransformationType.CLASS_TO_PLAIN?(L=o[C],L=y.applyCustomTransformations(L,r,C,o,y.transformationType),L=o[C]===L?l:L,L=y.transform(A,L,T,g,m,s+1)):void 0===l&&y.options.exposeDefaultValues?L=d[f]:(L=y.transform(A,l,T,g,m,s+1),L=y.applyCustomTransformations(L,r,C,o,y.transformationType)),(void 0!==L||y.options.exposeUnsetFields)&&(d instanceof Map?d.set(f,L):d[f]=L)}},y=this,T=0,m=c;T<m.length;T++){l(m[T])}return this.options.enableCircularCheck&&this.recursionStack.delete(o),d}return o}return o}return new Promise((function(t,e){o.then((function(e){return t(f.transform(void 0,e,r,void 0,void 0,s+1))}),e)}))}return null==o?o:Boolean(o)}return null==o?o:Number(o)}return null==o?o:String(o)},e.prototype.applyCustomTransformations=function(t,e,o,r,a){var i=this,s=n.findTransformMetadatas(e,o,this.transformationType);return void 0!==this.options.version&&(s=s.filter((function(t){return!t.options||i.checkVersion(t.options.since,t.options.until)}))),(s=this.options.groups&&this.options.groups.length?s.filter((function(t){return!t.options||i.checkGroups(t.options.groups)})):s.filter((function(t){return!t.options||!t.options.groups||!t.options.groups.length}))).forEach((function(e){t=e.transformFn({value:t,key:o,obj:r,type:a,options:i.options})})),t},e.prototype.isCircular=function(t){return this.recursionStack.has(t)},e.prototype.getReflectedType=function(t,e){if(t){var o=n.findTypeMetadata(t,e);return o?o.reflectedType:void 0}},e.prototype.getKeys=function(e,r,a){var i=this,s=n.getStrategy(e);"none"===s&&(s=this.options.strategy||"exposeAll");var p=[];if(("exposeAll"===s||a)&&(p=r instanceof Map?Array.from(r.keys()):Object.keys(r)),a)return p;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&e){var f=n.getExposedProperties(e,this.transformationType),u=n.getExcludedProperties(e,this.transformationType);p=o(o([],f),u)}if(!this.options.ignoreDecorators&&e){f=n.getExposedProperties(e,this.transformationType);this.transformationType===t.TransformationType.PLAIN_TO_CLASS&&(f=f.map((function(t){var o=n.findExposeMetadata(e,t);return o&&o.options&&o.options.name?o.options.name:t}))),p=this.options.excludeExtraneousValues?f:p.concat(f);var c=n.getExcludedProperties(e,this.transformationType);c.length>0&&(p=p.filter((function(t){return!c.includes(t)}))),void 0!==this.options.version&&(p=p.filter((function(t){var o=n.findExposeMetadata(e,t);return!o||!o.options||i.checkVersion(o.options.since,o.options.until)}))),p=this.options.groups&&this.options.groups.length?p.filter((function(t){var o=n.findExposeMetadata(e,t);return!o||!o.options||i.checkGroups(o.options.groups)})):p.filter((function(t){var o=n.findExposeMetadata(e,t);return!(o&&o.options&&o.options.groups&&o.options.groups.length)}))}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(p=p.filter((function(t){return i.options.excludePrefixes.every((function(e){return t.substr(0,e.length)!==e}))}))),p=p.filter((function(t,e,n){return n.indexOf(t)===e}))},e.prototype.checkVersion=function(t,e){var n=!0;return n&&t&&(n=this.options.version>=t),n&&e&&(n=this.options.version<e),n},e.prototype.checkGroups=function(t){return!t||this.options.groups.some((function(e){return t.includes(e)}))},e}(),a={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},i=function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},s=function(){function e(){}return e.prototype.instanceToPlain=function(e,n){return new r(t.TransformationType.CLASS_TO_PLAIN,i(i({},a),n)).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToPlainFromExist=function(e,n,o){return new r(t.TransformationType.CLASS_TO_PLAIN,i(i({},a),o)).transform(n,e,void 0,void 0,void 0,void 0)},e.prototype.plainToInstance=function(e,n,o){return new r(t.TransformationType.PLAIN_TO_CLASS,i(i({},a),o)).transform(void 0,n,e,void 0,void 0,void 0)},e.prototype.plainToClassFromExist=function(e,n,o){return new r(t.TransformationType.PLAIN_TO_CLASS,i(i({},a),o)).transform(e,n,void 0,void 0,void 0,void 0)},e.prototype.instanceToInstance=function(e,n){return new r(t.TransformationType.CLASS_TO_CLASS,i(i({},a),n)).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToClassFromExist=function(e,n,o){return new r(t.TransformationType.CLASS_TO_CLASS,i(i({},a),o)).transform(n,e,void 0,void 0,void 0,void 0)},e.prototype.serialize=function(t,e){return JSON.stringify(this.instanceToPlain(t,e))},e.prototype.deserialize=function(t,e,n){var o=JSON.parse(e);return this.plainToInstance(t,o,n)},e.prototype.deserializeArray=function(t,e,n){var o=JSON.parse(e);return this.plainToInstance(t,o,n)},e}();var p=new s;t.ClassTransformer=s,t.Exclude=function(t){return void 0===t&&(t={}),function(e,o){n.addExcludeMetadata({target:e instanceof Function?e:e.constructor,propertyName:o,options:t})}},t.Expose=function(t){return void 0===t&&(t={}),function(e,o){n.addExposeMetadata({target:e instanceof Function?e:e.constructor,propertyName:o,options:t})}},t.Transform=function(t,e){return void 0===e&&(e={}),function(o,r){n.addTransformMetadata({target:o.constructor,propertyName:r,transformFn:t,options:e})}},t.TransformInstanceToInstance=function(t){return function(e,n,o){var r=new s,a=o.value;o.value=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=a.apply(this,e),i=!!o&&("object"==typeof o||"function"==typeof o)&&"function"==typeof o.then;return i?o.then((function(e){return r.instanceToInstance(e,t)})):r.instanceToInstance(o,t)}}},t.TransformInstanceToPlain=function(t){return function(e,n,o){var r=new s,a=o.value;o.value=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=a.apply(this,e),i=!!o&&("object"==typeof o||"function"==typeof o)&&"function"==typeof o.then;return i?o.then((function(e){return r.instanceToPlain(e,t)})):r.instanceToPlain(o,t)}}},t.TransformPlainToInstance=function(t,e){return function(n,o,r){var a=new s,i=r.value;r.value=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var r=i.apply(this,n),s=!!r&&("object"==typeof r||"function"==typeof r)&&"function"==typeof r.then;return s?r.then((function(n){return a.plainToInstance(t,n,e)})):a.plainToInstance(t,r,e)}}},t.Type=function(t,e){return void 0===e&&(e={}),function(o,r){var a=Reflect.getMetadata("design:type",o,r);n.addTypeMetadata({target:o.constructor,propertyName:r,reflectedType:a,typeFunction:t,options:e})}},t.classToClassFromExist=function(t,e,n){return p.classToClassFromExist(t,e,n)},t.classToPlainFromExist=function(t,e,n){return p.classToPlainFromExist(t,e,n)},t.deserialize=function(t,e,n){return p.deserialize(t,e,n)},t.deserializeArray=function(t,e,n){return p.deserializeArray(t,e,n)},t.instanceToInstance=function(t,e){return p.instanceToInstance(t,e)},t.instanceToPlain=function(t,e){return p.instanceToPlain(t,e)},t.plainToClassFromExist=function(t,e,n){return p.plainToClassFromExist(t,e,n)},t.plainToInstance=function(t,e,n){return p.plainToInstance(t,e,n)},t.serialize=function(t,e){return p.serialize(t,e)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=class-transformer.umd.min.js.map
